<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#b00000" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ç‰›é€¼æ¨¡å‹åˆé›†">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <title>ç‰›é€¼æ¨¡å‹åˆé›†</title>

  <style>
    :root{
      --bg:#0b0b0f; --card:#11111a; --line:rgba(255,255,255,.10);
      --text:#f5f5f7; --muted:rgba(255,255,255,.65);
      --red:#ff2d2d; --red2:#b00000; --green:#2dff7a; --amber:#ffcc33;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background:
        radial-gradient(800px 400px at 50% 20%, rgba(255,45,45,.18), transparent 60%),
        radial-gradient(900px 500px at 50% 120%, rgba(176,0,0,.22), transparent 60%),
        var(--bg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
      color:var(--text);
      padding:18px;
    }
    .app{width:min(720px,100%);}
    .title{
      font-size:22px;font-weight:900;letter-spacing:.5px;margin:0 0 12px;
      display:flex;align-items:center;gap:10px;
    }
    .title::before{
      content:"";width:10px;height:10px;border-radius:50%;
      background:var(--red);box-shadow:0 0 18px rgba(255,45,45,.8);
    }
    .panel{
      background:linear-gradient(180deg, rgba(255,45,45,.08), transparent 50%), var(--card);
      border:1px solid var(--line);border-radius:18px;padding:16px;
      box-shadow:0 18px 60px rgba(0,0,0,.55);
    }
    input{
      width:100%;padding:14px 14px;font-size:20px;border-radius:14px;
      border:1px solid var(--line);background:rgba(0,0,0,.35);color:var(--text);outline:none;
    }
    input:focus{border-color:rgba(255,45,45,.6);box-shadow:0 0 0 3px rgba(255,45,45,.15);}
    button{
      width:100%;margin-top:10px;padding:12px 14px;font-size:16px;font-weight:900;
      border-radius:14px;border:1px solid rgba(255,45,45,.55);
      background:linear-gradient(180deg, rgba(255,45,45,.95), rgba(176,0,0,.95));
      color:#fff;cursor:pointer;
    }
    button:active{transform:translateY(1px);}
    .msg{margin-top:10px;font-size:13px;color:var(--muted);min-height:18px;}

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(2, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width: 620px){
      .grid{grid-template-columns:1fr;}
    }

    .card{
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(255,255,255,.03);
      padding:12px 12px;
    }
    .cardHead{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:8px;
    }
    .name{
      font-weight:900;letter-spacing:.3px;font-size:14px;
      display:flex;align-items:center;gap:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background:rgba(255,255,255,.35);
      box-shadow:0 0 14px rgba(255,255,255,.12);
    }
    .seatBig{
      font-size:34px;font-weight:1000;color:var(--red);
      text-shadow:0 0 18px rgba(255,45,45,.28);
      line-height:1;
    }
    .meta{
      margin-top:6px;font-size:12px;color:var(--muted);
      display:flex;flex-wrap:wrap;gap:8px;
    }
    .tag{
      font-size:11px;padding:4px 8px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25);
      color:rgba(255,255,255,.75);
    }
    .tag.green{border-color:rgba(45,255,122,.25); color:rgba(45,255,122,.9); background:rgba(45,255,122,.06);}
    .tag.amber{border-color:rgba(255,204,51,.25); color:rgba(255,204,51,.95); background:rgba(255,204,51,.06);}
    .tiny{margin-top:12px;font-size:12px;color:rgba(255,255,255,.5)}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>

<body>
  <div class="app">
    <div class="title">ç‰›é€¼æ¨¡å‹åˆé›†ï¼ˆä¸€ä¸ªè¾“å…¥æ¡†ï¼Œå¤šè´¦å·åŒå‡ºï¼‰</div>

    <div class="panel">
      <input id="room" inputmode="numeric" placeholder="è¾“å…¥5ä½æˆ¿å·ï¼ˆä¾‹å¦‚ï¼š51330ï¼‰" maxlength="5" />
      <button id="go">å¼€å¹²</button>

      <div class="msg" id="msg"></div>

      <div class="grid" id="grid" style="display:none;">
        <!-- cards injected by JS -->
      </div>

      <div class="tiny">
        è¯´æ˜ï¼šæ‰€æœ‰ <code>mod 5</code> ä½¿ç”¨çœŸå–æ¨¡ <code>((n%5)+5)%5</code>ï¼Œä¿è¯ä½™æ•°æ°¸è¿œæ˜¯ 0~4ã€‚
      </div>
    </div>
  </div>

  <script>
    // çœŸå–æ¨¡ï¼šæ°¸è¿œ 0..m-1
    const mod = (n,m)=>((n % m) + m) % m;

    // è§£æABCDE
    function parseABCDE(room5){
      const A=+room5[0], B=+room5[1], C=+room5[2], D=+room5[3], E=+room5[4];
      return {A,B,C,D,E};
    }

    // è®¡ç®—é‡å·ä¸ªæ•° rep = 5 - ä¸åŒæ•°å­—ä¸ªæ•°
    function calcRep(room5){
      const set = new Set(room5.split(""));
      return 5 - set.size;
    }

    // ===== å„è´¦å·æ¨¡å‹ =====

    // èœ¡ç¬”å°æ–°ç‰›é€¼æ¨¡å‹
    // V = -4A - 3B - 2C - 3D - E - 5
    // seat = (V mod 5) + 2
    function model_xj(room5){
      const {A,B,C,D,E} = parseABCDE(room5);
      const V = -4*A -3*B -2*C -3*D -E -5;
      const r = mod(V, 5);
      return { seat:r+2, extra:`V=${V}ï½œV mod 5=${r}` };
    }

    // æ¢¦è§ç‰›é€¼æ¨¡å‹
    // S = 2A + C + D + E
    // V = B - S
    // seat = (V mod 5) + 2
    function model_mj(room5){
      const {A,B,C,D,E} = parseABCDE(room5);
      const S = 2*A + C + D + E;
      const V = B - S;
      const r = mod(V, 5);
      return { seat:r+2, extra:`S=${S}ï½œV=${V}ï½œV mod 5=${r}` };
    }

    // å‘µå‘µå‘µç‰›é€¼æ¨¡å‹ - æ¨¡å‹Aï¼ˆ2/3ä¸»åŠ›ï¼Œä½†ä»è¾“å‡º2~6ï¼‰
    // V2 = B + C + 2D - 2E - 2
    // seat2 = (V2 mod 5) + 2
    function model_hhh_A(room5){
      const {A,B,C,D,E} = parseABCDE(room5);
      const V2 = B + C + 2*D - 2*E - 2;
      const r = mod(V2, 5);
      return { seat:r+2, extra:`Vâ‚‚=${V2}ï½œVâ‚‚ mod 5=${r}` };
    }

    // å‘µå‘µå‘µç‰›é€¼æ¨¡å‹ - æ¨¡å‹Bï¼ˆåªè´Ÿè´£ 4 / 5ï¼‰
    // rep = 5 - ä¸åŒæ•°å­—ä¸ªæ•°
    // par = 1 (Dä¸EåŒå¥‡å¶) else 0
    // S = A + B + C + D + rep + par
    // Så¶æ•°->4å·, Så¥‡æ•°->5å·
    function model_hhh_B(room5){
      const {A,B,C,D,E} = parseABCDE(room5);
      const rep = calcRep(room5);
      const par = ((D % 2) === (E % 2)) ? 1 : 0;
      const S = A + B + C + D + rep + par;
      const seat = (S % 2 === 0) ? 4 : 5;
      return { seat, extra:`rep=${rep}ï½œpar=${par}ï½œS=${S}ï½œS%2=${S%2}` };
    }

    // å…«æˆ’ç‰›é€¼æ¨¡å‹ vFinal
    // F = A+B+C+E ; R = F mod5 ; seat = R+2
    // å¼ºä¿¡å·ï¼šmax(B,C,D,E) >= 8
    function model_bj(room5){
      const {A,B,C,D,E} = parseABCDE(room5);
      const F = A + B + C + E;
      const R = mod(F, 5);
      const seat = R + 2;
      const mx = Math.max(B,C,D,E);
      const strong = mx >= 8;
      return {
        seat,
        extra:`F=${F}ï½œF mod 5=${R}ï½œmax(BCDE)=${mx}`,
        tags: [ strong ? {t:"ğŸ”¥ å¼ºä¿¡å·ï¼ˆå¯åŠ ä»“ï¼‰", cls:"green"} : {t:"æ™®é€šä¿¡å·ï¼ˆæ­£å¸¸ä»“ï¼‰", cls:""} ]
      };
    }

    // åçˆ±ç‰›é€¼æ¨¡å‹
    // V = -2A - B + 2C - D + 2E - 2
    // seat = (V mod5) +2
    function model_py(room5){
      const {A,B,C,D,E} = parseABCDE(room5);
      const V = -2*A - B + 2*C - D + 2*E - 2;
      const r = mod(V, 5);
      return { seat:r+2, extra:`V=${V}ï½œV mod 5=${r}` };
    }

    // ===== UI æ¸²æŸ“ =====
    const roomEl = document.getElementById("room");
    const goEl = document.getElementById("go");
    const msgEl = document.getElementById("msg");
    const gridEl = document.getElementById("grid");

    function cardHTML({name, seatText, extra, tags=[]}){
      const tagHTML = tags.map(x => `<span class="tag ${x.cls||""}">${x.t}</span>`).join("");
      return `
        <div class="card">
          <div class="cardHead">
            <div class="name"><span class="dot"></span>${name}</div>
            <div class="seatBig">${seatText}</div>
          </div>
          <div class="meta">
            <span class="tag">${extra}</span>
            ${tagHTML}
          </div>
        </div>
      `;
    }

    function run(){
      const s = roomEl.value.trim().replace(/\s+/g,"");
      if(!/^\d{5}$/.test(s)){
        msgEl.textContent = "è¯·è¾“å…¥æ­£ç¡®çš„5ä½æ•°å­—ï¼ˆä¾‹å¦‚ï¼š51330ï¼‰";
        gridEl.style.display = "none";
        gridEl.innerHTML = "";
        return;
      }

      msgEl.textContent = "";
      gridEl.style.display = "grid";

      const xj = model_xj(s);
      const mj = model_mj(s);
      const hA = model_hhh_A(s);
      const hB = model_hhh_B(s);
      const bj = model_bj(s);
      const py = model_py(s);

      // å‘µå‘µå‘µï¼šé¢å¤–æç¤ºå®ƒçš„ä¸¤ç»„ç”¨é€”ï¼ˆ23ä¸»åŠ›ã€45å£è¯€ï¼‰
      const hTagsA = [
        {t:"æ¨¡å‹Aï¼š2/3ä¸»åŠ›å‚è€ƒ", cls:"amber"},
        ((hA.seat===2||hA.seat===3) ? {t:"âœ…è½åœ¨2/3", cls:"green"} : {t:"é2/3ï¼ˆä»è¾“å‡ºï¼‰", cls:""} )
      ];
      const hTagsB = [{t:"æ¨¡å‹Bï¼šåªå‡º4/5å¯¹å†²", cls:"amber"}];

      gridEl.innerHTML = [
        cardHTML({name:"èœ¡ç¬”å°æ–°", seatText: `${xj.seat}å·`, extra: xj.extra}),
        cardHTML({name:"æ¢¦è§", seatText: `${mj.seat}å·`, extra: mj.extra}),
        cardHTML({name:"å‘µå‘µå‘µï¼ˆæ¨¡å‹Aï¼‰", seatText: `${hA.seat}å·`, extra: hA.extra, tags: hTagsA}),
        cardHTML({name:"å‘µå‘µå‘µï¼ˆæ¨¡å‹Bï¼‰", seatText: `${hB.seat}å·`, extra: hB.extra, tags: hTagsB}),
        cardHTML({name:"å…«æˆ’", seatText: `${bj.seat}å·`, extra: bj.extra, tags: bj.tags || []}),
        cardHTML({name:"åçˆ±", seatText: `${py.seat}å·`, extra: py.extra})
      ].join("");

      // è‡ªåŠ¨æ¸…ç©º + ç»§ç»­è¾“å…¥
      setTimeout(()=>{ roomEl.value=""; roomEl.focus(); }, 250);
    }

    goEl.addEventListener("click", run);
    roomEl.addEventListener("keydown", e => { if(e.key==="Enter") run(); });
    roomEl.focus();

    // æ³¨å†Œç¦»çº¿
    if("serviceWorker" in navigator){
      window.addEventListener("load", ()=>navigator.serviceWorker.register("./sw.js"));
    }
  </script>
</body>
</html>
